# Generated by Django 3.2.16 on 2023-01-10 05:49

from django.db import migrations, models

def change_playlist_reference(apps, schema_editor):
    apply_changes(apps, 'section')

def backwards_change_playlist_reference(apps, schema_editor):
    apply_changes(apps, 'experiment')

def apply_changes(apps, to_app):
    Experiment = apps.get_model('experiment', 'Experiment')
    Playlist = apps.get_model(to_app, 'Playlist')
    for exp in Experiment.objects.all():
        for playlist in exp.playlists.all():
            new_playlist = Playlist.objects.get(
                name=playlist.name
            )
            exp.playlists.remove(playlist)
            exp.playlists.add(new_playlist)
            exp.save()


class Migration(migrations.Migration):

    dependencies = [
        ('result', '0002_data_migration'),
        ('experiment', '0018_delete_profile'),
    ]

    operations = [
        migrations.AlterField(
            model_name='experiment',
            name='playlists',
            field=models.ManyToManyField(blank=True, to='section.Playlist'),
        ),
        migrations.RunPython(change_playlist_reference, backwards_change_playlist_reference)
    ]
